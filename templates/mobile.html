<!DOCTYPE html>
<html lang="en" ng-app="goReadMobileApp">
<head>
<title>go read</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link href="{{.BootstrapCss}}" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="/static/css/mobile.css"/>
</head>
<body class="ng-cloak"
	data-url-feeds="{{url "list-feeds"}}"
	data-url-contents="{{url "get-contents"}}"
	data-url-mark-read="{{url "mark-read"}}"
	data-url-mark-unread="{{url "mark-unread"}}"
	ng-controller="MainController"
	ng-init="init()">

<div class="header">
	<div class="brand">go read</div>
	{{if .User}}
	<a href="" id="btn-upgrade" class="btn btn-success btn-small">Upgrade</a>
	<div class="btn-group info">
		<a class="btn btn-small dropdown-toggle account" data-toggle="dropdown" href="#">
			{{.User}} <span class="caret"></span>
		</a>
		<ul class="dropdown-menu">
		<li><a href="{{url "logout"}}">logout</a></li>
		</ul>
	</div>
	{{end}}
</div>

<div class="nav top">
	{{if .User}}
	<div class="btn btn-small pull-left back-button"
		ng-show="backButton"
		ng-bind-html="backButton.label"
		ng-click="backButtonClick()"></div>
	<div class="pull-right">
		<div class="btn btn-small" ng-hide="loading" id="btn-refresh" ng-click="refresh()">
			<i class="icon-repeat"></i>
		</div>
		<div class="btn-group" ng-hide="loading">
			<a class="btn btn-small dropdown-toggle" id="btn-menu" data-toggle="dropdown" href="#">
				<i class="icon-chevron-down"></i>
			</a>
			<ul class="dropdown-menu">
			<li ng-click="setVisibility('all')"><a href="">
				<i ng-class="{'icon-ok':visibility=='all', 'icon-':visibility=='unread'}"></i>
				show all
			</a></li>
			<li ng-click="setVisibility('unread')"><a href="">
				<i ng-class="{'icon-ok':visibility=='unread', 'icon-':visibility=='all'}"></i>
				show updated
			</a></li>
			<li class="divider"></li>
			<li><a href=""><i class="icon-"></i> add subscription</a></li>
			</ul>
		</div>
	</div>
	<div class="title" ng-bind="title"></div>
	{{end}}
</div>

<div class="content">

{{if .User}}
<!-- story list -->
<div id="story-list" class="block" ng-show="!loading && mode=='story'" ng-controller="StoryController">
<ul class="story-list">
<li ng-repeat="story in stories"
	class="story"
	ng-class="{'open':story==activeStory, 'unread':story.Unread}"
	ng-click="show(story); resetScrollLeft();">
	<div class="head"
		ng-click="hide()" eat-click
		ng-show="story==activeStory">
		<p class="next" ng-hide="$last"
			ng-click="showIndex($index+1)" eat-click>
			<i class="icon-arrow-down"></i> Next item
		</p>
		<p class="collapser"><i class="icon-th-large"></i> Collapse</p>
	</div>
	<div class="meta">
		<p>
			<span class="title"
				ng-hide="story==activeStory"
				ng-bind="story.Title"></span>
			<a class="title" target="_blank"
				ng-show="story==activeStory"
				ng-href="{{`{{story.Link}}`}}"
				ng-bind="story.Title"></a>
			<span class="feed-title">&ndash; <span ng-bind="story.feed.Title"></span></span>
		</p>
		<p ng-hide="story==activeStory" class="excerpt" ng-bind="story.Summary"></p>
		<p ng-show="story==activeStory" class="date" ng-bind="story.Date * 1000 | date:'fullDate'"></p>
	</div>
	<div class="content" ng-show="story==activeStory">
		<div ng-show="contents[story.feed.XmlUrl][story.Id]" class="reset"
			ng-bind-html="contents[story.feed.XmlUrl][story.Id]"></div>
		<p ng-hide="contents[story.feed.XmlUrl][story.Id]" class="loading-content">
			loading content..
		</p>
	</div>
	<div class="action" ng-show="story==activeStory">
		<span>
			<label>
				<input type="checkbox"
					ng-model="story.Unread"
					ng-change="toggleRead(story)"/>
				Keep unread
			</label>
		</span>
		<span class="email">
			<a ng-href="mailto:?subject={{`{{story.Title | encodeURI}}`}}&body={{`{{story.Link | encodeURI}}`}}">
				<i class="icon-envelope"></i> Email
			</a>
		</span>
	</div>
</li>
<li class="load more"
	ng-show="hasMoreItems"
	ng-click="loadMoreStories()">
	<p>Load more items..</p>
	<p>more than <span ng-bind="stories.length"></span> items</p>
</li>
<li class="no more"
	ng-hide="hasMoreItems">
	<p ng-show="stories.length==1">1 item</p>
	<p ng-hide="stories.length==1"><span ng-bind="stories.length"></span> items</p>
</li>
<li class="mark-read control" ng-show="unreadCount>0">
	<p><a href="" ng-click="markItemsRead()">Mark these items as read</a></p>
</li>
</ul>
</div><!-- // story list -->
{{end}}

{{if .User}}
<!-- feed list -->
<div id="feed-list" class="block" ng-show="!loading && mode=='feed'" ng-controller="FeedController">
<ul class="feed-list"
	ng-class="{'top':isTop, 'in':!isTop}">
<li ng-show="isTop && feeds"
	ng-click="showAllItems()">
	<i class="icon-folder-open"></i>
	<!--
	<span class="count">100+</span>
	-->
	<span class="title unread">All items</span>
</li>
<li
	ng-click="showFolder(current); resetScrollLeft();"
	ng-hide="isTop">
	<i class="icon-folder-open"></i>
	<span class="title" ng-bind="current.Title"></span>
</li>
<li
	ng-repeat="feed in feeds"
	ng-click="open(feed); resetScrollLeft();"
	ng-class="{'feed':!feed.Outline}">
	<i ng-class="{'icon-th':!feed.Outline, 'icon-folder-open':feed.Outline}"></i>
	<span class="title" ng-bind="feed.Title"></span>
</li>
</ul>
</div><!-- //feed-list -->
{{end}}

{{if not .User}}
<!-- login -->
<div id="login" class="block" ng-show="!loading">
<h1>Hi, RSS user</h1>
<p>Go Read is a web-based RSS reader.</p>
<p>It is designed to be as useful as Google Reader.</p>
<p class="signin"><a href="{{url "login-google"}}" class="btn btn-primary">
	<img src="/static/img/google-signin.png" height="42" alt="sign up / log in with google"/>
</a></p>
</div><!-- //login -->
{{end}}

<!-- loading -->
<div id="loading" class="block" ng-show="loading">
	<p>loading..</p>
</div>

</div><!-- //content -->

<div class="nav bottom">
	<div class="btn btn-small pull-left back-button"
		ng-show="backButton"
		ng-bind-html="backButton.label"
		ng-click="backButtonClick()"></div>
</div>

	<script src="{{.Jquery}}"></script>
	<script src="{{.Underscore}}"></script>
	<script src="{{.BootstrapJs}}"></script>
	<script src="{{.Angular}}"></script>
	<script src="{{.AngularSanitize}}"></script>
	<script type="text/javascript" src="/static/js/mobile.js"></script>
</body>
</html>

